<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¦™æ¸¯æ€¥ç—‡å®¤ç­‰å€™æ™‚é–“å„€è¡¨æ¿</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Roboto+Mono:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            margin: 0;
            padding: 0;
            /* èƒŒæ™¯è‰²è¨­ç‚ºé€æ˜æˆ–èˆ‡ Hero Section ç›¸åŒï¼Œç¢ºä¿ iframe èåˆ */
            background-color: transparent; 
            font-family: 'Noto Sans TC', sans-serif;
            overflow-x: hidden; /* é˜²æ­¢ iframe å‡ºç¾æ©«å‘æ²è»¸ */
        }

        /* --- Style B: Sky & Code ç§‘æŠ€é¢¨æ ¼ (App ç¨ç«‹ç‰ˆ) --- */
        :root {
            --web-primary: #0EA5E9;
            --web-secondary: #38BDF8;
            --web-dark: #0F172A;
            --web-success: #22C55E;
            --web-warning: #F59E0B;
            --web-error: #EF4444;
            --web-critical: #8B5CF6;
            --web-bg-light: #F0F9FF;
            --text-main: #1E293B;
            --text-muted: #64748B;
        }

        /* å„€è¡¨æ¿å¤–æ¡† */
        .dashboard-container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--web-dark);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 20px 50px rgba(14, 165, 233, 0.15);
            color: white;
            text-align: center;
        }

        .hero-title {
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: 10px;
            background: linear-gradient(to right, #7DD3FC, #FFFFFF);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: inline-block;
        }

        .hero-p {
            color: #BAE6FD;
            font-size: 1rem;
            margin-bottom: 30px;
        }

        /* æ¨¡æ“¬ç€è¦½å™¨è¦–çª— */
        .browser-window {
            background: white;
            border-radius: 12px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            text-align: left;
        }

        .browser-bar {
            height: 30px;
            background: #F1F5F9;
            display: flex;
            align-items: center;
            padding: 0 15px;
            gap: 6px;
            border-bottom: 1px solid #E2E8F0;
        }

        .dot { width: 10px; height: 10px; border-radius: 50%; }
        .dot.red { background: #EF4444; }
        .dot.yellow { background: #F59E0B; }
        .dot.green { background: #10B981; }

        /* æ›´æ–°ç‹€æ…‹æ¢ */
        .update-banner {
            background: #F8FAFC;
            padding: 10px 20px;
            border-bottom: 1px solid #E2E8F0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-muted);
        }
        #aed-last-update { color: var(--web-primary); }

        /* æ»¾å‹•å€åŸŸ */
        .aed-scroll-area {
            padding: 20px;
            max-height: 600px; /* å¢åŠ é«˜åº¦ */
            overflow-y: auto;
            background: #FFFFFF;
        }

        /* å€åŸŸæ¨™é¡Œ */
        .region-title {
            font-size: 1.1rem;
            font-weight: 900;
            color: var(--text-main);
            margin: 20px 0 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 2px solid #E2E8F0;
            padding-bottom: 5px;
        }
        .region-title::before { content: ''; width: 4px; height: 18px; background: var(--web-primary); border-radius: 4px; }

        /* é†«é™¢å¡ç‰‡ */
        .aed-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .hosp-card {
            background: #F8FAFC;
            border: 1px solid #E2E8F0;
            border-left: 5px solid #CBD5E1;
            border-radius: 8px;
            padding: 12px;
            transition: all 0.2s;
        }
        .hosp-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.05); }

        .hosp-name { font-weight: 700; font-size: 0.9rem; color: var(--text-main); display: block; margin-bottom: 5px; }
        .wait-time { font-family: 'Roboto Mono', monospace; font-size: 1.2rem; font-weight: 700; text-align: right; display: block; }

        /* ç‹€æ…‹é¡è‰² */
        .wait-short { border-left-color: var(--web-success); }
        .wait-short .wait-time { color: var(--web-success); }
        .wait-medium { border-left-color: var(--web-warning); }
        .wait-medium .wait-time { color: var(--web-warning); }
        .wait-long { border-left-color: var(--web-error); }
        .wait-long .wait-time { color: var(--web-error); }
        .wait-very-long { border-left-color: var(--web-critical); }
        .wait-very-long .wait-time { color: var(--web-critical); }

        /* è¼‰å…¥/éŒ¯èª¤ç‹€æ…‹ */
        .status-msg { text-align: center; padding: 40px; color: var(--text-muted); }
        .error-msg { color: var(--web-error); }

        @media (max-width: 600px) {
            .hero-title { font-size: 1.5rem; }
            .aed-grid { grid-template-columns: 1fr; }
            .update-banner { flex-direction: column; gap: 5px; align-items: flex-start; }
        }
    </style>
</head>
<body>

<div class="dashboard-container">
    <div class="hero-title">é¦™æ¸¯æ€¥ç—‡å®¤ç­‰å€™æ™‚é–“</div>
    <div class="hero-p">å³æ™‚æ•¸æ“šåŒæ­¥è‡ªé†«é™¢ç®¡ç†å±€</div>

    <div class="browser-window">
        <div class="browser-bar">
            <div class="dot red"></div><div class="dot yellow"></div><div class="dot green"></div>
        </div>
        
        <div class="update-banner">
            <span>ğŸ“¡ è³‡æ–™ä¾†æºï¼šé†«ç®¡å±€</span>
            <span>æ›´æ–°æ–¼ï¼š<span id="aed-last-update">--:--</span></span>
        </div>

        <div class="aed-scroll-area" id="aed-main-container">
            <div class="status-msg">æ­£åœ¨è®€å– GitHub æ•¸æ“š...</div>
        </div>
    </div>
</div>

<script>
(function() {
    const mainContainer = document.getElementById('aed-main-container');
    const lastUpdateSpan = document.getElementById('aed-last-update');
    
    // ç›´æ¥è®€å– GitHub Actions ç”Ÿæˆçš„æœ¬åœ°æª”æ¡ˆ
    // åŠ å…¥æ™‚é–“æˆ³åƒæ•¸ (Cache Busting) ç¢ºä¿è®€å–æœ€æ–°ç‰ˆ
    const DATA_URL = './aed_data.json';

    const hospitalRegions = {
        "æ±å€å°¤å¾·å¤«äººé‚£æ‰“ç´ é†«é™¢": "é¦™æ¸¯å³¶", "ç‘ªéº—é†«é™¢": "é¦™æ¸¯å³¶", "å¾‹æ•¦æ²»é†«é™¢": "é¦™æ¸¯å³¶",
        "æ˜æ„›é†«é™¢": "ä¹é¾", "å»£è¯é†«é™¢": "ä¹é¾", "ä¼Šåˆ©æ²™ä¼¯é†«é™¢": "ä¹é¾", "åŸºç£æ•™è¯åˆé†«é™¢": "ä¹é¾",
        "é›…éº—æ°ä½•å¦™é½¡é‚£æ‰“ç´ é†«é™¢": "æ–°ç•Œ", "åŒ—å€é†«é™¢": "æ–°ç•Œ", "åŒ—å¤§å¶¼å±±é†«é™¢": "æ–°ç•Œ", "åšæ„›é†«é™¢": "æ–°ç•Œ",
        "å¨çˆ¾æ–¯è¦ªç‹é†«é™¢": "æ–°ç•Œ", "ç‘ªå˜‰çƒˆé†«é™¢": "æ–°ç•Œ", "é•·æ´²é†«é™¢": "æ–°ç•Œ", "å¤©æ°´åœé†«é™¢": "æ–°ç•Œ",
        "å°‡è»æ¾³é†«é™¢": "æ–°ç•Œ", "å±¯é–€é†«é™¢": "æ–°ç•Œ", "ä»æ¿Ÿé†«é™¢": "æ–°ç•Œ"
    };

    function getTimeClass(waitText) {
        if (waitText.includes("1")) return 'wait-short';
        if (waitText.includes("2") || waitText.includes("3")) return 'wait-medium';
        if (waitText.includes("4") || waitText.includes("5") || waitText.includes("6")) return 'wait-long';
        return 'wait-very-long';
    }

    async function fetchAEDData() {
        try {
            const noCacheUrl = `${DATA_URL}?t=${new Date().getTime()}`;
            const res = await fetch(noCacheUrl);
            
            if (!res.ok) throw new Error('Data file not found');
            
            const data = await res.json();
            
            lastUpdateSpan.textContent = data.updateTime || 'æœªçŸ¥';
            
            const regions = { 'é¦™æ¸¯å³¶': [], 'ä¹é¾': [], 'æ–°ç•Œ': [] };
            
            // æ•¸æ“šåˆ†çµ„
            if (data.waitTime && Array.isArray(data.waitTime)) {
                data.waitTime.forEach(h => {
                    const reg = hospitalRegions[h.hospName];
                    if (reg) regions[reg].push(h);
                });

                let html = "";
                ['é¦™æ¸¯å³¶', 'ä¹é¾', 'æ–°ç•Œ'].forEach(rName => {
                    const list = regions[rName];
                    if (list.length > 0) {
                        html += `<div class="region-title">${rName}</div>`;
                        html += `<div class="aed-grid">`;
                        list.forEach(h => {
                            const status = getTimeClass(h.topWait);
                            html += `
                                <div class="hosp-card ${status}">
                                    <span class="hosp-name">${h.hospName}</span>
                                    <span class="wait-time">${h.topWait}</span>
                                </div>
                            `;
                        });
                        html += `</div>`;
                    }
                });
                mainContainer.innerHTML = html;
            } else {
                throw new Error('Data format error');
            }

        } catch (e) {
            console.error(e);
            mainContainer.innerHTML = `
                <div class="status-msg error-msg">
                    <p>âš ï¸ æš«æ™‚ç„¡æ³•è®€å–æ•¸æ“š</p>
                    <p style="font-size:0.8rem; margin-top:10px; color:#64748B;">
                        è«‹ç¨å¾Œå†è©¦ã€‚GitHub Actions æ›´æ–°å¯èƒ½å»¶é²ã€‚
                    </p>
                </div>
            `;
        }
    }

    fetchAEDData();
    // é›–ç„¶é é¢ä¸æœƒå¸¸é–‹ï¼Œä½†æ¯ 60 ç§’æª¢æŸ¥ä¸€æ¬¡æ–°æ•¸æ“š
    setInterval(fetchAEDData, 60000);

})();
</script>
</body>
</html>
